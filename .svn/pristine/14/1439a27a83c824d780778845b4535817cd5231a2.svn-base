using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using DG.Tweening;
using UnityEngine;
using UniLua;

class LuaDoTweenLib
{
    static LuaClassRegHelper m_ClassRegHelper = new LuaClassRegHelper();

    public const string LIB_NAME = "DoTween";

    public static int OpenLib(ILuaState lua)
    {

        //注册成员函数
        NameFuncPair[] member_define = new NameFuncPair[]
        {
         
        };

        NameFuncPair[] operator_define = new NameFuncPair[]
        {
        };

        m_ClassRegHelper.RegMembers(lua, member_define, operator_define);


        //注册静态成员
        NameFuncPair[] static_define = new NameFuncPair[]
        { 
            new NameFuncPair("DORotate",S_DORotate),  
            new NameFuncPair("DOMove",S_DOMove),  
            new NameFuncPair("DOLocalMove",S_DOLocalMove),  
            new NameFuncPair("DOLocalRotate",S_DOLocalRotate),  
        };
        m_ClassRegHelper.RegStatics(lua, static_define);
        
        //注册枚举 
        NameValuePair[] enum_RotateMode = new NameValuePair[]
        {
            new NameValuePair("Fast",RotateMode.Fast),
            new NameValuePair("FastBeyond360",RotateMode.FastBeyond360),
            new NameValuePair("WorldAxisAdd",RotateMode.WorldAxisAdd),
            new NameValuePair("LocalAxisAdd",RotateMode.LocalAxisAdd)
        };
        m_ClassRegHelper.RegEnum(lua, "DoTweenRotateMode", enum_RotateMode);

        return 1;
    }
     
    static int S_DORotate(ILuaState lua)
    {
        //in GameObject,endValue,duration,DoTweenRotateMode
        //out Tween
        GameObject obj = LuaGameObjectLib.Lua2Obj(lua, 1);
        Vector3 endValue; LuaVector3Lib.Lua2Obj(lua, 2,out endValue);
        float duration = (float)lua.L_CheckNumber(3);
        RotateMode md = (RotateMode)lua.L_CheckInteger(4);
        LuaTweenLib._wrap(
            lua,
            NewTweenSet(obj.transform.DORotate(endValue, duration, md) )
            );
        return 1;
    }

    static int S_DOMove(ILuaState lua)
    {
        
        //in GameObject,endValue,duration
        //out Tween
        GameObject obj = LuaGameObjectLib.Lua2Obj(lua, 1);
        Vector3 endValue; LuaVector3Lib.Lua2Obj(lua, 2,out endValue);
        float duration = (float)lua.L_CheckNumber(3);
        LuaTweenLib._wrap(lua, NewTweenSet(obj.transform.DOMove(endValue, duration) ));
        return 1;
    }

    static int S_DOLocalRotate(ILuaState lua)
    {
        //in GameObject,endValue,duration,DoTweenRotateMode
        //out Tween
        GameObject obj = LuaGameObjectLib.Lua2Obj(lua, 1);
        Vector3 endValue; LuaVector3Lib.Lua2Obj(lua, 2, out endValue);
        float duration = (float)lua.L_CheckNumber(3);
        RotateMode md = (RotateMode)lua.L_CheckInteger(4);
        LuaTweenLib._wrap(
            lua,
            NewTweenSet(obj.transform.DOLocalRotate(endValue, duration, md))
            );
        return 1;
    }

    static int S_DOLocalMove(ILuaState lua)
    {

        //in GameObject,endValue,duration
        //out Tween
        GameObject obj = LuaGameObjectLib.Lua2Obj(lua, 1);
        Vector3 endValue; LuaVector3Lib.Lua2Obj(lua, 2, out endValue);
        float duration = (float)lua.L_CheckNumber(3);
        LuaTweenLib._wrap(lua, NewTweenSet (obj.transform.DOLocalMove(endValue, duration) ));
        return 1;
    }
     

    public static T NewTweenSet<T>(T tw) where T:Tween
    {
        return tw.SetAutoKill(true).SetRecyclable(false);
    }
}
 