local class = require("common/middleclass")
local ui_kejitree = class("ui_kejitree", wnd_base)

local sdataTB
local maxKejiNum = 6
local perKejiNum = {6, 6, 6, 6}
function ui_kejitree:OnShowDone()
    ui_kejitree = self
    sdataTB = {sdata_kejitree_jingji_data, sdata_kejitree_gongji_data, sdata_kejitree_fangyu_data, sdata_kejitree_shengming_data}
    local bg2 = self.transform:Find("bg2")
    self.page1_jingji = self.transform:Find("page1_jingji")--经济标签
    self.page2_gongji = self.transform:Find("page2_gongji")--攻击标签
    self.page3_fangyu = self.transform:Find("page3_fangyu")--防御标签
    self.page4_shengming = self.transform:Find("page4_shengming")--生命标签
    self.backBtn = self.transform:Find("backBtn")--返回按钮
    self.shengji = bg2:Find("shengji")--升级/加速/激活
    
    self.kejiBtn = {}--科技按钮tb
    self.kejiBtnUISprite = {}--科技按钮US
    self.kejiLevel = {}--科技等级UL
    self.kejiName = {}--科技名称UL
    for i = 1, maxKejiNum do
        self.kejiBtn[i] = bg2:Find("kejiIcon" .. i)--单个科技按钮
        self.kejiBtnUISprite[i] = self.kejiBtn[i]:GetComponent(typeof(UISprite))
        self.kejiLevel[i] = self.kejiBtn[i]:Find("level"):GetComponent(typeof(UILabel))
        self.kejiName[i] = self.kejiBtn[i]:Find("kejiName"):GetComponent(typeof(UILabel))
        UIEventListener.Get(self.kejiBtn[i].gameObject).onClick = function(go)
            self:changePage(i)
        end
    end
    
    self:changePage(1)

end

--切换页面 1.经济 2.攻击 3.防御 4.生命
function ui_kejitree:changePage(index)
    local kejiNum = perKejiNum[index]
    local kejiID
    for i = 1, kejiNum do
        self.kejiBtn[i].gameObject:SetActive(true)
        
        if kejiP[index][i].kejiLevel == 0 then --未激活
            kejiID = tonumber(kejiP[index][i].kejiID .. string.format("%03d", 1))
            self.kejiLevel[i].text = sdata_UILiteral:GetV(sdata_UILiteral.I_Literal, 10011)
            self.kejiBtnUISprite[i].spriteName = sdataTB[index]:GetFieldV("TechIcon", kejiID)
            self.kejiName[i].text = sdataTB[index]:GetFieldV("TechName", kejiID)
        else --已激活
            kejiID = tonumber(kejiP[index][i].kejiID .. string.format("%03d", kejiP[index][i].kejiLevel))
            self.kejiLevel[i].text = sdataTB[index]:GetFieldV("Level", kejiID) .. sdata_UILiteral:GetV(sdata_UILiteral.I_Literal, 10012)
            self.kejiBtnUISprite[i].spriteName = sdataTB[index]:GetFieldV("TechIcon", kejiID)
            self.kejiName[i].text = sdataTB[index]:GetFieldV("TechName", kejiID)
        end
    
    end
    for i = kejiNum + 1, maxKejiNum do
        self.kejiBtn[i].gameObject:SetActive(false)
    end
end

return ui_kejitree
