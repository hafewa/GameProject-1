using UnityEngine;
using System.Collections;

public class myTest : MonoBehaviour
{
    private Transform blood;
    private Camera nowWorldCamera;
    private bool isRun = false;
    private Transform Head;
    //private float Fomat;
    void Start()
    {
        nowWorldCamera = GameObject.Find("/PTZCamera/SceneryCamera").GetComponent<Camera>();

        Head = transform.Find("head");
        //Fomat = Vector3.Distance(Head.position, nowWorldCamera.transform.position);
        blood =
            GameObjectExtension.InstantiateFromPacket("ui_fightU", "blood.prefab", GameObject.Find("UIRoot")).transform;
        blood.localScale = Vector3.zero;
        StartCoroutine(startToRun());
    }

    private IEnumerator startToRun()
    {
        yield return new WaitForSeconds(1);
        isRun = true;
        //UIFollowTarget uft = blood.gameObject.AddComponent<UIFollowTarget>();
        //uft.target = Head;
        //uft.uiCamera = UICamera.currentCamera;
        //uft.gameCamera = nowWorldCamera;

        blood.localScale = Vector3.one;
        GetComponent<MFAModelRender>().speedScale = 1;
        GetComponent<MeshRenderer>().material.shader = Shader.Find("Standard");
        GetComponent<MFAModelRender>().SetClip("run".GetHashCode());
    }

    void Update()
    {
        if (!isRun)
        {
            return;
        }
        transform.Translate(0, 0, 10 * Time.deltaTime);

        //float newFomat = Fomat / Vector3.Distance(Head.position, nowWorldCamera.transform.position);
        Vector3 pt = nowWorldCamera.WorldToScreenPoint(Head.position);
        Vector3 ff = UICamera.currentCamera.ScreenToWorldPoint(pt);
        //ff.z = 0;
        blood.position = ff;
        //blood.localScale = Vector3.one * newFomat;
    }
}
