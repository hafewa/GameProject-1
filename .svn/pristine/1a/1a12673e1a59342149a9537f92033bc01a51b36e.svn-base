local class = require("common/middleclass")
local ui_chongzhu = class("ui_chongzhu", wnd_base)
local v
function ui_chongzhu:OnShowDone()
    ui_chongzhu = self
    self.eqBg = self.transform:Find("bg/eqBg")--eqBg
    self.info1UL = self.transform:Find("bg/infoBG/info1"):GetComponent(typeof(UILabel))--介绍UILabel
    self.info1UL.text = sdata_UILiteral:GetV(sdata_UILiteral.I_Literal, 10006)
    self.chongzhushuxingBg = self.transform:Find("bg/shuxingBg")--3条待选属性bg
    self.daojuBg = self.transform:Find("bg/daojuBg")--道具bg
    self.djBg = self.daojuBg:Find("bg")--道具bg
    
    
    
    if iseqShuXingBg then --装备详情界面跳转
        v = equipP.nowEqList[eqInfoType]
    else --更换装备界面跳转
        v = equipP.allEqList[eqChangeType][eqChangeIndex]
    end
    
    setEqIconView(self.eqBg, v)
    self.eqBg:Find("eqName"):GetComponent(typeof(UILabel)).text = sdata_Equip_data:GetV(sdata_Equip_data.I_EquipName, v.EquipID)
    
    self.eqBg:Find("uigrid/maiShuxingBg/shuxing"):GetComponent(typeof(UILabel)).text = sdata_EffectName_data:GetV(sdata_EffectName_data.I_EffectName, v.MainEffectID) .. "+" .. sdata_EquipPlan_data[sdata_Equip_data:GetV(sdata_Equip_data.I_MainEffect, v.EquipID)][v.MainEffectID].up .. sdata_EffectName_data:GetV(sdata_EffectName_data.I_Symbol, v.MainEffectID)
    
    
    self.shuxingBg = {}--5个附加属性btn
    self.selectEffect = {}--5个附加属性Bg选中效果
    self.shuxingUL = {}--5个附加属性UILabel
    self.shuxingBgSprite = {}--5个附加属性UISpite
    for i = 1, 5 do
        self.shuxingBg[i] = self.eqBg:Find("uigrid/shuxingBg" .. i)
        self.selectEffect[i] = self.shuxingBg[i]:Find("selectEffect")
        self.shuxingUL[i] = self.shuxingBg[i]:Find("shuxing"):GetComponent(typeof(UILabel))
        self.shuxingBgSprite[i] = self.shuxingBg[i]:GetComponent(typeof(UISprite))
    end
    
    
    --设置附加属性
    for i, v in ipairs(v.ViceEffect) do
        self.shuxingUL[i].text = sdata_EffectName_data:GetV(sdata_EffectName_data.I_EffectName, v.ShuXingID) .. "+" .. v.ShuXingNum .. sdata_EffectName_data:GetV(sdata_EffectName_data.I_Symbol, v.ShuXingID)
        UIEventListener.Get(self.shuxingBg[i].gameObject).onClick = function(go)
            if self.chongzhushuxingBg.gameObject.activeSelf then
                return
            end
            --点击增加选中效果
            for j, v in ipairs(self.shuxingBg) do
                if j ~= i then
                    self.selectEffect[j].gameObject:SetActive(false)
                end
            end
            self.selectEffect[i].gameObject:SetActive(true)
            self:setDaoJuInfo(i)
        end
    end
    local str = sdata_UILiteral:GetV(sdata_UILiteral.I_Literal, 10001)
    for i = #v.ViceEffect + 1, v.EquipQuality - 1 do
        self.shuxingUL[i].text = string.gsub(str, "#N", tostring(i * 3))
    end
    for i = v.EquipQuality, 5 do
        self.shuxingUL[i].enabled = false
        self.shuxingBgSprite[i].spriteName = "slider_yellow"
    end
    
    
    self.backBtn = self.transform:Find("bg/backBtn")--返回按钮
    UIEventListener.Get(self.backBtn.gameObject).onClick = function(go)
        if self.chongzhushuxingBg.gameObject.activeSelf then
            return
        end
        ui_manager:DestroyWB(self)
    end
    
    
    
    self.cz_shuxingBg = {}--3个重铸属性btn
    self.cz_selectEffect = {}--3个重铸属性Bg选中效果
    self.cz_shuxingUL = {}--3个重铸属性UILabel
    self.cz_shuxingBgMaxSprite = {}--3个重铸属性UISpite
    for i = 1, 3 do
        self.cz_shuxingBg[i] = self.chongzhushuxingBg:Find("shuxingBg" .. i)
        self.cz_selectEffect[i] = self.cz_shuxingBg[i]:Find("selectEffect")
        self.cz_shuxingUL[i] = self.cz_shuxingBg[i]:Find("shuxing"):GetComponent(typeof(UILabel))
        self.cz_shuxingBgMaxSprite[i] = self.cz_shuxingBg[i]:Find("maxSpr"):GetComponent(typeof(UISprite))
        UIEventListener.Get(self.cz_shuxingBg[i].gameObject).onClick = function(go)
                --点击增加选中效果
                for j, v in ipairs(self.cz_shuxingBg) do
                    if j ~= i then
                        self.cz_selectEffect[j].gameObject:SetActive(false)
                        self.cz_shuxingBgMaxSprite[j].gameObject:SetActive(false)
                    end
                end
                self.cz_selectEffect[i].gameObject:SetActive(true)
                self.cz_shuxingBgMaxSprite[i].gameObject:SetActive(true)
        end
    end
    for i, v in ipairs(v.ViceEffect) do
        if v.Remake then --如果有待替换副属性
            self.selectEffect[i].gameObject:SetActive(true)
            self.daojuBg.gameObject:SetActive(false)
            
            self:setCZShuXingInfo(i)
            break
        end
    end
end

function ui_chongzhu:setDaoJuInfo(index)
    self.djBg.gameObject:SetActive(true)
end

function ui_chongzhu:setCZShuXingInfo(index)
    self.chongzhushuxingBg.gameObject:SetActive(true)
    for i, v in ipairs(v.ViceEffect[index].Remake) do
        self.cz_shuxingUL[i].text = sdata_EffectName_data:GetV(sdata_EffectName_data.I_EffectName, v.RemakeShuXingID) .. "+" .. v.RemakeShuXingNum .. sdata_EffectName_data:GetV(sdata_EffectName_data.I_Symbol, v.RemakeShuXingID)
    end
end

return ui_chongzhu
