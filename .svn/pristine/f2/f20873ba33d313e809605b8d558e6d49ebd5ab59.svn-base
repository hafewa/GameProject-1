using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Collections;
using UnityEngine;
using UniLua;

public   class Module_UniLua : IModule
{
    public   IEnumerator Init()
    {
        //挂载lua调试器组件
        UROMSystem.Single.AddComponent<CMLuaDebugger>(); 

        var _Lua = LuaRoot._Lua;
        if (_Lua != null) yield break;

        //挂载lua代码缓存组件
        CMLuaCodeCache codeCache = UROMSystem.Single.AddComponent<CMLuaCodeCache>();

        //等待lua代码缓存完成
        while (!codeCache.IsDone) yield return null;


        //创建虚拟机
        _Lua = LuaAPI.NewState();

        //注册系统函数 加载基本库
        _Lua.L_OpenLibs();

        //注册内核级别的自定义函数
        LuaOpenLibs.OpenLibs(_Lua);

        //设置根路径
        LuaFile.SetPathHook(LuaRoot.PathHook);

        LuaRoot._Lua = _Lua;
    }
}